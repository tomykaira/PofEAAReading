# Chapter10 データソースのアーキテクチャに関するパターン
## テーブルデータゲートウェイ
データベーステーブルに対するゲートウェイ。1つのインスタンスで全ての行を処理する。


* 基本的なCRUD処理を持っていて、データの受け渡しが役割なのでステートレス。
* 特徴的なのは、一意なデータだとしても複数形(コレクション？)のデータを返す事ができること。
* データの形としてはマッピングやデータ変換オブジェクト、レコードセットなどがある。


### 使用するタイミング(関連パターン？)
* ゲートウェイがよいかどうかを判断。
* テーブルモジュールと併用するのが最適。トランザクションスクリプトとでもいいかんじ。
* データ変換オブジェクトは再利用性によって採用を考える。
* データマッパーがテーブルデータゲートウェイを使用するのもよい。（本当か？
* プロシージャとかも広義にはテーブルデータゲートウェイにいれられる。	



## 行データゲートウェイ
1つのレコードに対するゲートウェイ。行毎に1つのインスタンスを持つ。

* findをどこに置くかが問題になりやすいが、静的なメソッドはさけるべき。独立したFindオブジェクトでやることもある。（そうなの？
* アクティブレコードとの違いはドメインロジックを持つかどうか。
* 自動生成しやすい構成なので、それを活かすとよい。


### 使用するタイミング
* ゲートウェイがよいかどうかを判断。
* トランザクションスクリプトとの相性がよい。他のトランザクションスクリプトで再利用しやすくなる。
* ドメインモデルを採用するなら、結果としてアクティブレコードになりやすいので、行データゲートウェイにならない。
* データマッパーと行データゲートウェイを併用することもある。前者は手動、後者は自動生成で。


## アクティブレコード
テーブルもしくはビューの行をラップしてデータベースアクセスとドメインロジックを内包するオブジェクト。

* 本質はドメインモデルで、なおかつデータベースレコード構造とほぼ一致している。
* 次のようなメソッドをもつことになる。　-> p171 中段を参照


### 使用するタイミング
* 複雑ではないドメインロジックに対して。
* シンプルであることが最大の利点であり、それには、データベースのスキームと同一であるという制約がある。
* トランザクションスクリプトの弊害が大きくなってきたときの打開策にも優れている。


## データマッパー
オブジェクト、データベース、マッパー自体の独立性を保ちつつ、オブジェクトとデータベース間でデータを移動するマッパーのレイヤ。

* ドメインレイヤは基本的にデータマッパーについて知らないということ重要。(ドメインクラスのファクトリみたいなものか？
* findは一意マッピングを使用する。
* 関連データを大量にもってきてしまう場合があるので、レイジーロードを活用する
* どうしてもドメインがfindをほしくなったときはfindのセパレートインターフェースを導入する。
* ドメインフィールドへのマッピングはsetterよりはリッチなコンストラクタで。immutableにもしやすい。
* メタデータベースってDIとかプロパティとか外部からっていう意味で良いのか？

### 使用するタイミング

* ドメインモデルと一緒に。
* メリットはどのタイミングでも「データベースを意識しなくてよい」ということ。（たぶんデータソースレイヤ以外においてという意味
* 十分にシンプルなら、ドメインモデルもデータマッパーも過剰。アクティブレコードでもいい。


サンプルコードながい。
